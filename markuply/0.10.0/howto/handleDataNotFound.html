<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Handle 404 from external data source :: Markuply reference</title>
    <link rel="canonical" href="https://wttech.github.io/markuply/markuply/0.10.0/howto/handleDataNotFound.html">
    <link rel="prev" href="../tutorials/httpTutorial.html">
    <link rel="next" href="accessLog.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://wttech.github.io/markuply">Markuply reference</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">

    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="markuply" data-version="0.10.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Markuply</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">What&#8217;s Markuply?</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../projectSetup.html">Project setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/componentRegistration.html">Component registration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/pageContext.html">Page context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/componentInnerContent.html">Component inner content</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/nestedComponents.html">Nested components</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Processing pages</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../processor/httpPageProcessor.html">HTTP pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../processor/classpathPageProcessor.html">Classpath pipeline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Error handling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../errorHandling/handlingErrors.html">Handling errors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../errorHandling/componentProcessingError.html">Component processing error</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../errorHandling/missingComponent.html">Missing component</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cache</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cache/requestScopedCache.html">Request scoped cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cache/parsedTemplateCache.html">Parsed template cache</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/classpathTutorial.html">Classpath pipeline tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/httpTutorial.html">HTTP pipeline tutorial</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">How to</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="handleDataNotFound.html">Handle 404 from external data source</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="accessLog.html">Maintain access log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformAllPages.html">Process all pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="defineMultipleHttpPipelines.html">Defining multiple HTTP pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="processInnerContentAsTemplate.html">Process inner content as a component template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developWithJavascript.html">Integrate with Javascript</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="disableDataPropsDecoding.html">Disable data-props decoding</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://javadoc.io/doc/io.wttech.markuply/markuply/0.10.0">Javadoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Markuply</span>
    <span class="version">0.10.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Markuply</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.10.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Markuply</a></li>
    <li>How to</li>
    <li><a href="handleDataNotFound.html">Handle 404 from external data source</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/wttech/markuply/edit/main/engine/src/docs/antora/modules/ROOT/pages/howto/handleDataNotFound.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Handle 404 from external data source</h1>
<div class="sect1">
<h2 id="_problem"><a class="anchor" href="#_problem"></a>Problem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You want to serve under <code>/books/{isbn}</code> a dynamically generated page for every book retrieved from an external API .</p>
</div>
<div class="paragraph">
<p>When sending GET requests to external API to retrieve book details for some ISBNs the API returns 404 Not Found status.</p>
</div>
<div class="paragraph">
<p>How to make Spring return 404 as well?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution"><a class="anchor" href="#_solution"></a>Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To handle special cases in an uniform way Spring <code>@ResponseStatus</code> can be applied to a custom exception class.</p>
</div>
<div class="listingblock">
<div class="title">BookNotFoundException.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ResponseStatus(value=HttpStatus.NOT_FOUND)
public class BookNotFoundException extends RuntimeException {
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When controller encounters such exception Spring will set the response type according to the value defined in the annotation.</p>
</div>
<div class="paragraph">
<p>Exceptions should be thrown right away so the best place to so is the service class responsible for invoking the external API.</p>
</div>
<div class="listingblock">
<div class="title">BookApiClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ResponseStatus(value=HttpStatus.NOT_FOUND)
@Component
public class BookApiClient {

  private final WebClient webClient = WebClient.builder().build();

  public Mono&lt;Book&gt; getBook(String isbn) {
    webClient.get()
      .uri("https://book.api/books/" + isbn)
      .retrieve()
      .onStatus(status -&gt; status.equals(HttpStatus.NOT_FOUND),
          response -&gt; Mono.error(new BookNotFoundException()))
      .bodyToMono(Book.class);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>getBook()</code> method is invoked outside Markuply context (in controller) then <code>BookNotFoundException</code> will reach Spring
exception handling mechanism.</p>
</div>
<div class="paragraph">
<p>However if that same method is invoked within Markuply component then it will be swallowed by the default <code>ComponentErrorHandler</code>.</p>
</div>
<div class="paragraph">
<p>To mitigate that we have to customize the error handler by providing it with exception types which should be passed downstream
as they should affect the generation of the whole page rather than just a fragment.</p>
</div>
<div class="listingblock">
<div class="title">SpringConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
ComponentErrorHandler handler() {
  return ComponentErrorHandlers.logAllExcept(BookNotFoundException.class);
}</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../tutorials/httpTutorial.html">HTTP pipeline tutorial</a></span>
  <span class="next"><a href="accessLog.html">Maintain access log</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script>
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/markuply/0.10.0/howto/handleDataNotFound.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
